<mujoco model="franka_panda_calligraphy">
  <compiler angle="radian" meshdir="../assets" autolimits="true"/>

  <option timestep="0.002" integrator="implicitfast">
    <flag contact="enable" gravity="enable"/>
  </option>

  <visual>
    <headlight diffuse="0.6 0.6 0.6" ambient="0.3 0.3 0.3" specular="0 0 0"/>
    <rgba haze="0.15 0.25 0.35 1"/>
    <!-- 全局视觉设置：相机角度 + 离屏渲染缓冲区大小 -->
    <global azimuth="120" elevation="-20" offwidth="1280" offheight="720"/>
  </visual>

  <asset>
    <texture type="skybox" builtin="gradient" rgb1="0.3 0.5 0.7" rgb2="0 0 0" width="512" height="3072"/>
    <texture type="2d" name="groundplane" builtin="checker" mark="edge" rgb1="0.2 0.3 0.4" rgb2="0.1 0.2 0.3" markrgb="0.8 0.8 0.8" width="300" height="300"/>
    <material name="groundplane" texture="groundplane" texuniform="true" texrepeat="5 5" reflectance="0.2"/>

    <texture name="paper" type="2d" builtin="flat" rgb1="0.95 0.95 0.9" width="512" height="512"/>
    <material name="paper" texture="paper" rgba="0.95 0.95 0.9 1"/>

    <material name="robot" rgba="0.9 0.9 0.9 1"/>
    <material name="black" rgba="0.1 0.1 0.1 1"/>
  </asset>

  <default>
    <joint damping="1" armature="0.1"/>
    <geom condim="3" friction="0.8 0.005 0.0001" solimp="0.95 0.995 0.001" solref="0.002 1"/>
    <motor ctrllimited="true"/>
    <default class="visual">
      <geom contype="0" conaffinity="0" group="2" type="mesh" material="robot"/>
    </default>
    <default class="collision">
      <geom group="3" type="mesh"/>
    </default>
  </default>

  <worldbody>
    <light pos="0 0 3" dir="0 0 -1" directional="true"/>
    <geom name="floor" size="0 0 0.05" type="plane" material="groundplane"/>

    <!-- 俯视相机 (从机器人上方向下看) -->
    <!-- lookat: (0.25, -0.2, 0.3), distance: 1.5, azimuth: 90, elevation: -45 -->
    <camera name="top_view" mode="targetbody" target="panda_link0" pos="0.25 0.8 1.3" euler="1.0 0 1.57" fovy="50"/>

    <!-- Paper surface for calligraphy -->
    <body name="paper" pos="0.5 0 0.01">
      <geom name="paper_surface" type="box" size="0.15 0.21 0.001" material="paper" friction="1.2 0.005 0.0001"/>
      <site name="paper_center" pos="0 0 0.001" size="0.005" rgba="0 0 1 0.3"/>
    </body>

    <!-- Franka Panda Robot -->
    <body name="panda_link0" pos="0 0 0">
      <inertial pos="0 0 0.05" mass="3.0" diaginertia="0.01 0.01 0.01"/>
      <geom name="link0" type="cylinder" size="0.06 0.05" rgba="0.9 0.9 0.9 1"/>

      <body name="panda_link1" pos="0 0 0.1">
        <inertial pos="0 0 0.05" mass="2.7" diaginertia="0.01 0.01 0.01"/>
        <joint name="joint1" type="hinge" pos="0 0 0" axis="0 0 1" range="-2.8973 2.8973" damping="10"/>
        <geom name="link1" type="cylinder" size="0.05 0.05" rgba="0.8 0.8 0.8 1"/>

        <body name="panda_link2" pos="0 0 0.1" euler="1.5708 0 0">
          <inertial pos="0 0 0.05" mass="2.7" diaginertia="0.01 0.01 0.01"/>
          <joint name="joint2" type="hinge" pos="0 0 0" axis="0 0 1" range="-1.7628 1.7628" damping="10"/>
          <geom name="link2" type="cylinder" size="0.05 0.05" rgba="0.9 0.9 0.9 1"/>

          <body name="panda_link3" pos="0 0 0.195" euler="-1.5708 0 0">
            <inertial pos="0 0 0.1" mass="2.5" diaginertia="0.01 0.01 0.01"/>
            <joint name="joint3" type="hinge" pos="0 0 0" axis="0 0 1" range="-2.8973 2.8973" damping="10"/>
            <geom name="link3" type="cylinder" size="0.05 0.12" rgba="0.8 0.8 0.8 1"/>

            <body name="panda_link4" pos="0.0825 0 0.12" euler="1.5708 0 0">
              <inertial pos="0 0 0.05" mass="2.5" diaginertia="0.01 0.01 0.01"/>
              <joint name="joint4" type="hinge" pos="0 0 0" axis="0 0 1" range="-3.0718 -0.0698" damping="10"/>
              <geom name="link4" type="cylinder" size="0.05 0.05" rgba="0.9 0.9 0.9 1"/>

              <body name="panda_link5" pos="-0.0825 0 0.19" euler="-1.5708 0 0">
                <inertial pos="0 0 0.1" mass="1.5" diaginertia="0.008 0.008 0.008"/>
                <joint name="joint5" type="hinge" pos="0 0 0" axis="0 0 1" range="-2.8973 2.8973" damping="8"/>
                <geom name="link5" type="cylinder" size="0.04 0.12" rgba="0.8 0.8 0.8 1"/>

                <body name="panda_link6" pos="0 0 0.12" euler="1.5708 0 0">
                  <inertial pos="0 0 0.03" mass="1.5" diaginertia="0.008 0.008 0.008"/>
                  <joint name="joint6" type="hinge" pos="0 0 0" axis="0 0 1" range="-0.0175 3.7525" damping="8"/>
                  <geom name="link6" type="cylinder" size="0.04 0.03" rgba="0.9 0.9 0.9 1"/>

                  <body name="panda_link7" pos="0.088 0 0.03" euler="-1.5708 0 0">
                    <inertial pos="0 0 0.05" mass="0.5" diaginertia="0.001 0.001 0.001"/>
                    <joint name="joint7" type="hinge" pos="0 0 0" axis="0 0 1" range="-2.8973 2.8973" damping="5"/>
                    <geom name="link7" type="cylinder" size="0.035 0.05" rgba="0.8 0.8 0.8 1"/>

                    <!-- End effector with brush -->
                    <body name="end_effector" pos="0 0 0.107">
                      <inertial pos="0 0 0.02" mass="0.3" diaginertia="0.0005 0.0005 0.0005"/>
                      <geom name="ee_mount" type="cylinder" size="0.03 0.02" rgba="0.3 0.3 0.3 1"/>

                      <!-- Brush holder -->
                      <body name="brush_holder" pos="0 0 0.02">
                        <inertial pos="0 0 0.05" mass="0.1" diaginertia="0.0001 0.0001 0.0001"/>
                        <geom name="holder" type="cylinder" size="0.008 0.05" rgba="0.2 0.2 0.2 1"/>

                        <!-- Brush tip (contact point) -->
                        <body name="brush_tip" pos="0 0 0.05">
                          <geom name="brush" type="sphere" size="0.003" rgba="0 0 0 1"
                                friction="0.9 0.005 0.0001" solimp="0.99 0.999 0.0001" solref="0.001 0.5"/>
                          <site name="brush_contact" pos="0 0 0" size="0.002" rgba="1 0 0 0.5"/>
                        </body>
                      </body>

                      <!-- End effector site for control -->
                      <site name="ee_site" pos="0 0 0.07" size="0.01" rgba="0 1 0 0.3"/>
                    </body>
                  </body>
                </body>
              </body>
            </body>
          </body>
        </body>
      </body>
    </body>
  </worldbody>

  <actuator>
    <motor name="motor1" joint="joint1" gear="100" ctrlrange="-87 87"/>
    <motor name="motor2" joint="joint2" gear="100" ctrlrange="-87 87"/>
    <motor name="motor3" joint="joint3" gear="100" ctrlrange="-87 87"/>
    <motor name="motor4" joint="joint4" gear="100" ctrlrange="-87 87"/>
    <motor name="motor5" joint="joint5" gear="100" ctrlrange="-12 12"/>
    <motor name="motor6" joint="joint6" gear="100" ctrlrange="-12 12"/>
    <motor name="motor7" joint="joint7" gear="100" ctrlrange="-12 12"/>
  </actuator>

  <sensor>
    <framepos name="ee_pos" objtype="site" objname="ee_site"/>
    <framequat name="ee_quat" objtype="site" objname="ee_site"/>
    <framepos name="brush_pos" objtype="site" objname="brush_contact"/>
    <touch name="brush_touch" site="brush_contact"/>
    <force name="brush_force" site="brush_contact"/>
  </sensor>

  <contact>
    <exclude body1="panda_link6" body2="panda_link7"/>
    <exclude body1="panda_link5" body2="panda_link6"/>
  </contact>
</mujoco>
